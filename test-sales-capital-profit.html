<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Ventas - Capital y Ganancias</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-center">Test Sistema de Ventas con Capital y Ganancias</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <!-- Capital -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 text-blue-600">Capital Actual</h2>
                <div id="current-capital" class="text-2xl font-bold text-blue-600">Bs. 0.00</div>
                <div class="mt-2 text-sm text-gray-600">Se suma el costo recuperado de ingredientes</div>
            </div>
            
            <!-- Ganancias -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 text-green-600">Ganancias Actuales</h2>
                <div id="current-profit" class="text-2xl font-bold text-green-600">Bs. 0.00</div>
                <div class="mt-2 text-sm text-gray-600">Se suma la ganancia de ventas</div>
            </div>
            
            <!-- Ventas Hoy -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4 text-purple-600">Ventas Hoy</h2>
                <div id="today-sales" class="text-2xl font-bold text-purple-600">Bs. 0.00</div>
                <div class="mt-2 text-sm text-gray-600">Total de ventas del d√≠a</div>
            </div>
        </div>

        <!-- Simulador de Venta -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">Simulador de Venta</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Plato:</label>
                    <select id="test-dish" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        <option value="">Seleccionar plato</option>
                        <option value="pollo" data-price="20.00" data-cost="8.00">Pollo - Bs. 20.00 (Costo: Bs. 8.00)</option>
                        <option value="salchipapa" data-price="15.00" data-cost="5.00">Salchipapa - Bs. 15.00 (Costo: Bs. 5.00)</option>
                        <option value="hamburguesa" data-price="25.00" data-cost="10.00">Hamburguesa - Bs. 25.00 (Costo: Bs. 10.00)</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Cantidad:</label>
                    <input type="number" id="test-quantity" value="1" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Precio:</label>
                    <input type="number" id="test-price" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                </div>
                
                <div class="flex items-end">
                    <button id="test-add" class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600">
                        Agregar
                    </button>
                </div>
            </div>
            
            <div class="flex gap-4">
                <button id="test-save" class="bg-green-500 text-white py-2 px-6 rounded-md hover:bg-green-600">
                    Guardar Venta
                </button>
                <button id="test-clear" class="bg-gray-500 text-white py-2 px-6 rounded-md hover:bg-gray-600">
                    Limpiar
                </button>
            </div>
        </div>

        <!-- Items en la Venta -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h3 class="text-lg font-semibold mb-4">Platos en la Venta:</h3>
            <div id="test-items-list" class="space-y-2 mb-4"></div>
            <div class="border-t pt-4">
                <div class="flex justify-between items-center">
                    <span class="text-lg font-semibold">Total de la Venta:</span>
                    <span id="test-total" class="text-xl font-bold text-green-600">Bs. 0.00</span>
                </div>
                <div class="flex justify-between items-center text-sm text-gray-600">
                    <span>Costo Total:</span>
                    <span id="test-cost-total">Bs. 0.00</span>
                </div>
                <div class="flex justify-between items-center text-sm text-gray-600">
                    <span>Ganancia Total:</span>
                    <span id="test-profit-total" class="text-green-600 font-semibold">Bs. 0.00</span>
                </div>
            </div>
        </div>

        <!-- Historial de Ventas -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h3 class="text-lg font-semibold mb-4">Historial de Ventas:</h3>
            <div id="test-sales-history" class="space-y-2">
                <p class="text-gray-500">No hay ventas registradas</p>
            </div>
        </div>
    </div>

    <script>
        let testSaleItems = [];
        let testSalesHistory = [];
        let currentCapital = 1000; // Capital inicial
        let currentProfit = 0; // Ganancias iniciales

        // Update displays
        function updateDisplays() {
            document.getElementById('current-capital').textContent = `Bs. ${currentCapital.toFixed(2)}`;
            document.getElementById('current-profit').textContent = `Bs. ${currentProfit.toFixed(2)}`;
            
            const todayTotal = testSalesHistory.reduce((sum, sale) => sum + sale.totalAmount, 0);
            document.getElementById('today-sales').textContent = `Bs. ${todayTotal.toFixed(2)}`;
        }

        // Test dish selection
        document.getElementById('test-dish').addEventListener('change', (e) => {
            const selectedOption = e.target.selectedOptions[0];
            if (selectedOption && selectedOption.dataset.price) {
                document.getElementById('test-price').value = selectedOption.dataset.price;
            }
        });

        // Test add dish
        document.getElementById('test-add').addEventListener('click', () => {
            const dishId = document.getElementById('test-dish').value;
            const quantity = parseInt(document.getElementById('test-quantity').value);
            const price = parseFloat(document.getElementById('test-price').value);

            if (!dishId || !quantity || !price) {
                alert('Por favor completa todos los campos');
                return;
            }

            const selectedOption = document.getElementById('test-dish').selectedOptions[0];
            const dishName = selectedOption.textContent.split(' - ')[0];
            const cost = parseFloat(selectedOption.dataset.cost);

            // Check if dish already exists
            const existingIndex = testSaleItems.findIndex(item => item.dishId === dishId);
            
            if (existingIndex >= 0) {
                // Update existing item
                testSaleItems[existingIndex].quantity += quantity;
                testSaleItems[existingIndex].totalPrice = testSaleItems[existingIndex].quantity * price;
                testSaleItems[existingIndex].totalCost = testSaleItems[existingIndex].quantity * cost;
                testSaleItems[existingIndex].profit = testSaleItems[existingIndex].totalPrice - testSaleItems[existingIndex].totalCost;
            } else {
                // Add new item
                testSaleItems.push({
                    dishId: dishId,
                    dishName: dishName,
                    quantity: quantity,
                    price: price,
                    cost: cost,
                    totalPrice: quantity * price,
                    totalCost: quantity * cost,
                    profit: (quantity * price) - (quantity * cost)
                });
            }

            updateTestItemsList();
            
            // Clear form
            document.getElementById('test-dish').value = '';
            document.getElementById('test-quantity').value = '1';
            document.getElementById('test-price').value = '';
        });

        // Test save sale
        document.getElementById('test-save').addEventListener('click', () => {
            if (testSaleItems.length === 0) {
                alert('Agrega al menos un plato');
                return;
            }

            const totalAmount = testSaleItems.reduce((sum, item) => sum + item.totalPrice, 0);
            const totalCost = testSaleItems.reduce((sum, item) => sum + item.totalCost, 0);
            const totalProfit = testSaleItems.reduce((sum, item) => sum + item.profit, 0);

            // Create sale record
            const sale = {
                id: Date.now(),
                items: [...testSaleItems],
                totalAmount: totalAmount,
                totalCost: totalCost,
                totalProfit: totalProfit,
                itemCount: testSaleItems.length,
                createdAt: new Date()
            };

            // Add to history
            testSalesHistory.push(sale);

            // Update capital and profit
            currentCapital += totalCost; // Add back ingredient costs (recovery)
            currentProfit += totalProfit; // Add profit

            // Update displays
            updateDisplays();
            updateTestSalesHistory();

            // Clear current sale
            testSaleItems = [];
            updateTestItemsList();

            alert(`Venta guardada exitosamente!\nTotal: Bs. ${totalAmount.toFixed(2)}\nCosto recuperado: Bs. ${totalCost.toFixed(2)} (sumado al capital)\nGanancia: Bs. ${totalProfit.toFixed(2)} (sumada a ganancias)`);
        });

        // Test clear
        document.getElementById('test-clear').addEventListener('click', () => {
            testSaleItems = [];
            updateTestItemsList();
        });

        function updateTestItemsList() {
            const container = document.getElementById('test-items-list');
            const totalDisplay = document.getElementById('test-total');
            const costDisplay = document.getElementById('test-cost-total');
            const profitDisplay = document.getElementById('test-profit-total');

            if (testSaleItems.length === 0) {
                container.innerHTML = '<p class="text-gray-500">No hay platos agregados</p>';
                totalDisplay.textContent = 'Bs. 0.00';
                costDisplay.textContent = 'Bs. 0.00';
                profitDisplay.textContent = 'Bs. 0.00';
                return;
            }

            container.innerHTML = testSaleItems.map((item, index) => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                    <div>
                        <span class="font-semibold">${item.dishName}</span>
                        <span class="text-sm text-gray-600"> (${item.quantity} √ó Bs. ${item.price.toFixed(2)})</span>
                    </div>
                    <div class="text-right">
                        <div class="font-bold">Bs. ${item.totalPrice.toFixed(2)}</div>
                        <div class="text-xs text-gray-500">Costo: Bs. ${item.totalCost.toFixed(2)} | Ganancia: Bs. ${item.profit.toFixed(2)}</div>
                    </div>
                </div>
            `).join('');

            const total = testSaleItems.reduce((sum, item) => sum + item.totalPrice, 0);
            const totalCost = testSaleItems.reduce((sum, item) => sum + item.totalCost, 0);
            const totalProfit = testSaleItems.reduce((sum, item) => sum + item.profit, 0);

            totalDisplay.textContent = `Bs. ${total.toFixed(2)}`;
            costDisplay.textContent = `Bs. ${totalCost.toFixed(2)}`;
            profitDisplay.textContent = `Bs. ${totalProfit.toFixed(2)}`;
        }

        function updateTestSalesHistory() {
            const container = document.getElementById('test-sales-history');
            
            if (testSalesHistory.length === 0) {
                container.innerHTML = '<p class="text-gray-500">No hay ventas registradas</p>';
                return;
            }

            container.innerHTML = testSalesHistory.map(sale => `
                <div class="p-3 bg-green-50 border border-green-200 rounded">
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="font-semibold">Venta #${sale.id.toString().slice(-6)}</div>
                            <div class="text-sm text-gray-600">
                                ${sale.items.map(item => `${item.dishName} (${item.quantity})`).join(', ')}
                            </div>
                            <div class="text-xs text-gray-500">
                                Costo recuperado: Bs. ${sale.totalCost.toFixed(2)} | Ganancia: Bs. ${sale.totalProfit.toFixed(2)}
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-green-600">Bs. ${sale.totalAmount.toFixed(2)}</div>
                            <div class="text-xs text-gray-500">${sale.createdAt.toLocaleTimeString()}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Initialize
        updateDisplays();
        updateTestItemsList();
    </script>
</body>
</html>
